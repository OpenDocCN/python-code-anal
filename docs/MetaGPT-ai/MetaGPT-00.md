# MetaGPT源码解析 0

# MetaGPT: The Multi-Agent Framework

<p align="center">
<a href=""><img src="docs/resources/MetaGPT-new-log.png" alt="MetaGPT logo: Enable GPT to work in software company, collaborating to tackle more complex tasks." width="150px"></a>
</p>

<p align="center">
<b>Assign different roles to GPTs to form a collaborative software entity for complex tasks.</b>
</p>

<p align="center">
<a href="docs/README_CN.md"><img src="https://img.shields.io/badge/文档-中文版-blue.svg" alt="CN doc"></a>
<a href="README.md"><img src="https://img.shields.io/badge/document-English-blue.svg" alt="EN doc"></a>
<a href="docs/README_JA.md"><img src="https://img.shields.io/badge/ドキュメント-日本語-blue.svg" alt="JA doc"></a>
<a href="https://discord.gg/wCp6Q3fsAk"><img src="https://img.shields.io/badge/Discord-Join-blue?logo=discord&logoColor=white&color=blue" alt="Discord Follow"></a>
<a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License: MIT"></a>
<a href="docs/ROADMAP.md"><img src="https://img.shields.io/badge/ROADMAP-路线图-blue" alt="roadmap"></a>
<a href="https://twitter.com/MetaGPT_"><img src="https://img.shields.io/twitter/follow/MetaGPT?style=social" alt="Twitter Follow"></a>
</p>

<p align="center">
   <a href="https://airtable.com/appInfdG0eJ9J4NNL/shrEd9DrwVE3jX6oz"><img src="https://img.shields.io/badge/AgentStore-Waitlist-ffc107?logoColor=white" alt="AgentStore Waitlist"></a>
   <a href="https://vscode.dev/redirect?url=vscode://ms-vscode-remote.remote-containers/cloneInVolume?url=https://github.com/geekan/MetaGPT"><img src="https://img.shields.io/static/v1?label=Dev%20Containers&message=Open&color=blue&logo=visualstudiocode" alt="Open in Dev Containers"></a>
   <a href="https://codespaces.new/geekan/MetaGPT"><img src="https://img.shields.io/badge/Github_Codespace-Open-blue?logo=github" alt="Open in GitHub Codespaces"></a>
   <a href="https://huggingface.co/spaces/deepwisdom/MetaGPT" target="_blank"><img alt="Hugging Face" src="https://img.shields.io/badge/%F0%9F%A4%97%20-Hugging%20Face-blue?color=blue&logoColor=white" /></a>
</p>

1. MetaGPT takes a **one line requirement** as input and outputs **user stories / competitive analysis / requirements / data structures / APIs / documents, etc.**
2. Internally, MetaGPT includes **product managers / architects / project managers / engineers.** It provides the entire process of a **software company along with carefully orchestrated SOPs.**
   1. `Code = SOP(Team)` is the core philosophy. We materialize SOP and apply it to teams composed of LLMs.

![A software company consists of LLM-based roles](docs/resources/software_company_cd.jpeg)

<p align="center">Software Company Multi-Role Schematic (Gradually Implementing)</p>

## MetaGPT's Abilities


https://github.com/geekan/MetaGPT/assets/34952977/34345016-5d13-489d-b9f9-b82ace413419



## Examples (fully generated by GPT-4)

For example, if you type `python startup.py "Design a RecSys like Toutiao"`, you would get many outputs, one of them is data & api design

![Jinri Toutiao Recsys Data & API Design](docs/resources/workspace/content_rec_sys/resources/data_api_design.png)

It costs approximately **$0.2** (in GPT-4 API fees) to generate one example with analysis and design, and around **$2.0** for a full project.




## Installation

### Installation Video Guide

- [Matthew Berman: How To Install MetaGPT - Build A Startup With One Prompt!!](https://youtu.be/uT75J_KG_aY)

### Traditional Installation

```pybash
# Step 1: Ensure that NPM is installed on your system. Then install mermaid-js. (If you don't have npm in your computer, please go to the Node.js official website to install Node.js https://nodejs.org/ and then you will have npm tool in your computer.)
npm --version
sudo npm install -g @mermaid-js/mermaid-cli

# Step 2: Ensure that Python 3.9+ is installed on your system. You can check this by using:
python --version

# Step 3: Clone the repository to your local machine, and install it.
git clone https://github.com/geekan/metagpt
cd metagpt
pip install -e.
```

**Note:**

- If already have Chrome, Chromium, or MS Edge installed, you can skip downloading Chromium by setting the environment variable
  `PUPPETEER_SKIP_CHROMIUM_DOWNLOAD` to `true`.

- Some people are [having issues](https://github.com/mermaidjs/mermaid.cli/issues/15) installing this tool globally. Installing it locally is an alternative solution,

  ```pybash
  npm install @mermaid-js/mermaid-cli
  ```

- don't forget to the configuration for mmdc in config.yml

  ```pyyml
  PUPPETEER_CONFIG: "./config/puppeteer-config.json"
  MMDC: "./node_modules/.bin/mmdc"
  ```

- if `pip install -e.` fails with error `[Errno 13] Permission denied: '/usr/local/lib/python3.11/dist-packages/test-easy-install-13129.write-test'`, try instead running `pip install -e. --user`

- To convert Mermaid charts to SVG, PNG, and PDF formats. In addition to the Node.js version of Mermaid-CLI, you now have the option to use Python version Playwright, pyppeteer or mermaid.ink for this task.

  - Playwright
    - **Install Playwright**

    ```pybash
    pip install playwright
    ```

    - **Install the Required Browsers**

    to support PDF conversion, please install Chrominum.

    ```pybash
    playwright install --with-deps chromium
    ```

    - **modify `config.yaml`**

    uncomment MERMAID_ENGINE from config.yaml and change it to `playwright`

    ```pyyaml
    MERMAID_ENGINE: playwright
    ```

  - pyppeteer
    - **Install pyppeteer**

    ```pybash
    pip install pyppeteer
    ```

    - **Use your own Browsers**

    pyppeteer allows you use installed browsers,  please set the following envirment
    
    ```pybash
    export PUPPETEER_EXECUTABLE_PATH = /path/to/your/chromium or edge or chrome
    ```

    please do not use this command to install browser, it is too old

    ```pybash
    pyppeteer-install
    ```

    - **modify `config.yaml`**

    uncomment MERMAID_ENGINE from config.yaml and change it to `pyppeteer`

    ```pyyaml
    MERMAID_ENGINE: pyppeteer
    ```

  - mermaid.ink
    - **modify `config.yaml`**

    uncomment MERMAID_ENGINE from config.yaml and change it to `ink`

    ```pyyaml
    MERMAID_ENGINE: ink
    ```  

    Note: this method does not support pdf export.

### Installation by Docker

```pybash
# Step 1: Download metagpt official image and prepare config.yaml
docker pull metagpt/metagpt:latest
mkdir -p /opt/metagpt/{config,workspace}
docker run --rm metagpt/metagpt:latest cat /app/metagpt/config/config.yaml > /opt/metagpt/config/key.yaml
vim /opt/metagpt/config/key.yaml # Change the config

# Step 2: Run metagpt demo with container
docker run --rm \
    --privileged \
    -v /opt/metagpt/config/key.yaml:/app/metagpt/config/key.yaml \
    -v /opt/metagpt/workspace:/app/metagpt/workspace \
    metagpt/metagpt:latest \
    python startup.py "Write a cli snake game"

# You can also start a container and execute commands in it
docker run --name metagpt -d \
    --privileged \
    -v /opt/metagpt/config/key.yaml:/app/metagpt/config/key.yaml \
    -v /opt/metagpt/workspace:/app/metagpt/workspace \
    metagpt/metagpt:latest

docker exec -it metagpt /bin/bash
$ python startup.py "Write a cli snake game"
```

The command `docker run ...` do the following things:

- Run in privileged mode to have permission to run the browser
- Map host configure file `/opt/metagpt/config/key.yaml` to container `/app/metagpt/config/key.yaml`
- Map host directory `/opt/metagpt/workspace` to container `/app/metagpt/workspace`
- Execute the demo command `python startup.py "Write a cli snake game"`

### Build image by yourself

```pybash
# You can also build metagpt image by yourself.
git clone https://github.com/geekan/MetaGPT.git
cd MetaGPT && docker build -t metagpt:custom .
```

## Configuration

- Configure your `OPENAI_API_KEY` in any of `config/key.yaml / config/config.yaml / env`
- Priority order: `config/key.yaml > config/config.yaml > env`

```pybash
# Copy the configuration file and make the necessary modifications.
cp config/config.yaml config/key.yaml
```

| Variable Name                              | config/key.yaml                           | env                                             |
| ------------------------------------------ | ----------------------------------------- | ----------------------------------------------- |
| OPENAI_API_KEY # Replace with your own key | OPENAI_API_KEY: "sk-..."                  | export OPENAI_API_KEY="sk-..."                  |
| OPENAI_API_BASE # Optional                 | OPENAI_API_BASE: "https://<YOUR_SITE>/v1" | export OPENAI_API_BASE="https://<YOUR_SITE>/v1" |

## Tutorial: Initiating a startup

```pyshell
# Run the script
python startup.py "Write a cli snake game"
# Do not hire an engineer to implement the project
python startup.py "Write a cli snake game" --implement False
# Hire an engineer and perform code reviews
python startup.py "Write a cli snake game" --code_review True
```

After running the script, you can find your new project in the `workspace/` directory.

### Preference of Platform or Tool

You can tell which platform or tool you want to use when stating your requirements.

```pyshell
python startup.py "Write a cli snake game based on pygame"
```

### Usage

```py
NAME
    startup.py - We are a software startup comprised of AI. By investing in us, you are empowering a future filled with limitless possibilities.

SYNOPSIS
    startup.py IDEA <flags>

DESCRIPTION
    We are a software startup comprised of AI. By investing in us, you are empowering a future filled with limitless possibilities.

POSITIONAL ARGUMENTS
    IDEA
        Type: str
        Your innovative idea, such as "Creating a snake game."

FLAGS
    --investment=INVESTMENT
        Type: float
        Default: 3.0
        As an investor, you have the opportunity to contribute a certain dollar amount to this AI company.
    --n_round=N_ROUND
        Type: int
        Default: 5

NOTES
    You can also use flags syntax for POSITIONAL ARGUMENTS
```

### Code walkthrough

```pypython
from metagpt.software_company import SoftwareCompany
from metagpt.roles import ProjectManager, ProductManager, Architect, Engineer

async def startup(idea: str, investment: float = 3.0, n_round: int = 5):
    """Run a startup. Be a boss."""
    company = SoftwareCompany()
    company.hire([ProductManager(), Architect(), ProjectManager(), Engineer()])
    company.invest(investment)
    company.start_project(idea)
    await company.run(n_round=n_round)
```

You can check `examples` for more details on single role (with knowledge base) and LLM only examples.

## QuickStart

It is difficult to install and configure the local environment for some users. The following tutorials will allow you to quickly experience the charm of MetaGPT.

- [MetaGPT quickstart](https://deepwisdom.feishu.cn/wiki/CyY9wdJc4iNqArku3Lncl4v8n2b)

Try it on Huggingface Space
- https://huggingface.co/spaces/deepwisdom/MetaGPT

## Citation

For now, cite the [Arxiv paper](https://arxiv.org/abs/2308.00352):

```pybibtex
@misc{hong2023metagpt,
      title={MetaGPT: Meta Programming for Multi-Agent Collaborative Framework},
      author={Sirui Hong and Xiawu Zheng and Jonathan Chen and Yuheng Cheng and Jinlin Wang and Ceyao Zhang and Zili Wang and Steven Ka Shing Yau and Zijuan Lin and Liyang Zhou and Chenyu Ran and Lingfeng Xiao and Chenglin Wu},
      year={2023},
      eprint={2308.00352},
      archivePrefix={arXiv},
      primaryClass={cs.AI}
}
```

## Contact Information

If you have any questions or feedback about this project, please feel free to contact us. We highly appreciate your suggestions!

- **Email:** alexanderwu@fuzhi.ai
- **GitHub Issues:** For more technical inquiries, you can also create a new issue in our [GitHub repository](https://github.com/geekan/metagpt/issues).

We will respond to all questions within 2-3 business days.

## Demo

https://github.com/geekan/MetaGPT/assets/2707039/5e8c1062-8c35-440f-bb20-2b0320f8d27d

## Join us

📢 Join Our Discord Channel!
https://discord.gg/ZRHeExS6xv

Looking forward to seeing you there! 🎉


# `setup.py`

该代码是一个 Python 的类，属于 `wutils` 包。它通过 `subprocess` 库安装 `mermaid-js/mermaid-cli` 包的 `@mermaid-js/mermaid-cli` 依赖，使用 `find_packages` 函数查找 `wutils` 包的依赖，然后通过 `setup` 函数设置命令行参数，最后通过 `Command` 类创建一个自定义命令行类，执行 `npm install -g @mermaid-js/mermaid-cli` 命令。


```py
"""wutils: handy tools
"""
import subprocess
from codecs import open
from os import path

from setuptools import Command, find_packages, setup


class InstallMermaidCLI(Command):
    """A custom command to run `npm install -g @mermaid-js/mermaid-cli` via a subprocess."""

    description = "install mermaid-cli"
    user_options = []

    def run(self):
        try:
            subprocess.check_call(["npm", "install", "-g", "@mermaid-js/mermaid-cli"])
        except subprocess.CalledProcessError as e:
            print(f"Error occurred: {e.output}")


```

这段代码的作用是创建一个名为 "metagpt" 的 Python 包，并包含一个用于读取和写入 README.md 和 requirements.txt 文件的组件。

具体来说，代码首先通过 abspath 方法获取了当前工作目录（即包所在的目录）的绝对路径，并将其存储在名为 here 的变量中。接下来，代码使用 with 语句打开了一个名为 "README.md" 的文件，并将其内容读取到一个变量 long_description 中。然后，代码再次使用 with 语句打开了一个名为 "requirements.txt" 的文件，并将其内容读取到多个变量 requirements 中，每个变量都是一个单独的行。

接着，代码通过 find_packages 函数查找并安装了几个 Python 库，这些库被用于构建 Meta-GPT。最后，代码定义了包的版本、描述、依赖关系等信息，并提供了几个可用于安装 Meta-GPT 的命令。


```py
here = path.abspath(path.dirname(__file__))

with open(path.join(here, "README.md"), encoding="utf-8") as f:
    long_description = f.read()

with open(path.join(here, "requirements.txt"), encoding="utf-8") as f:
    requirements = [line.strip() for line in f if line]

setup(
    name="metagpt",
    version="0.1",
    description="The Multi-Role Meta Programming Framework",
    long_description=long_description,
    long_description_content_type="text/markdown",
    url="https://gitlab.deepwisdomai.com/pub/metagpt",
    author="Alexander Wu",
    author_email="alexanderwu@fuzhi.ai",
    license="Apache 2.0",
    keywords="metagpt multi-role multi-agent programming gpt llm",
    packages=find_packages(exclude=["contrib", "docs", "examples"]),
    python_requires=">=3.9",
    install_requires=requirements,
    extras_require={
        "playwright": ["playwright>=1.26", "beautifulsoup4"],
        "selenium": ["selenium>4", "webdriver_manager", "beautifulsoup4"],
        "search-google": ["google-api-python-client==2.94.0"],
        "search-ddg": ["duckduckgo-search==3.8.5"],
        "pyppeteer": ["pyppeteer>=1.0.2"],
    },
    cmdclass={
        "install_mermaid": InstallMermaidCLI,
    },
)

```

# `startup.py`

这段代码是一个Python脚本，使用了`asyncio`、`fire`和`metagpt`库。它的作用是启动一个Asyncio服务器，然后使用这个服务器来连接到另一个名为"人工智能编辑器"的软件，进行一系列的任务。

具体来说，这段代码会：

1. 导入`asyncio`、`fire`和`metagpt`库。
2. 导入自定义的`Architect`、`Engineer`、`ProductManager`、`ProjectManager`和`QaEngineer`类，这些类都继承自`metagpt.roles`类，用于实现与"人工智能编辑器"的交互。
3. 导入`SoftwareCompany`类，用于在"人工智能编辑器"中代表公司。
4. 在脚本的开始部分，使用`asyncio.run`函数创建一个异步服务器。这个服务器将监听来自"人工智能编辑器"的连接请求，并负责将它们转发给"人工智能编辑器"的相应角色。
5. 在服务器运行的过程中，使用`fire.start`函数来启动"人工智能编辑器"应用程序。这个应用程序会将一些任务委托给"人工智能编辑器"中的AI，以执行一些编辑工作。
6. 在"人工智能编辑器"应用程序中，使用`asyncio.sleep`函数来等待AI完成任务。
7. 在脚本的最后部分，使用`fire.put`函数，将"人工智能编辑器"应用程序的所有输出结果提交给"人工智能编辑器"中代表公司的角色。


```py
#!/usr/bin/env python
# -*- coding: utf-8 -*-
import asyncio

import fire

from metagpt.roles import (
    Architect,
    Engineer,
    ProductManager,
    ProjectManager,
    QaEngineer,
)
from metagpt.software_company import SoftwareCompany


```

这段代码定义了一个名为startup的函数，用于启动一家名为"SoftwareCompany"的公司。函数接收多个参数，包括一个idea参数，一个investment参数(默认值为3.0)，以及一个n_round参数(默认值为5)，用于运行多少次startup函数。函数还包括一个code_review参数(默认值为False)，用于指示是否要进行代码审查，以及一个run_tests参数(默认值为False)，用于指示是否要在运行时运行单元测试。

如果设置了run_tests参数为True，那么函数将使用QaEngineer(质量保证员)开发功能，并在运行时运行单元测试。如果设置了code_review参数为True，那么函数将使用CodeReviewer(代码审查员)开发功能，并在运行时运行代码审查。如果设置了implement参数为True，那么函数将使用Engineer(工程师)开发功能，并在运行时根据需要修改现有的代码。

在函数中，使用SoftwareCompany()创建了一家公司，并使用了多个 hiring() 方法(hire,invest,start_project,run)来招募员工，启动项目，运行公司。最后，如果设置了is_code_review和is_run_tests参数为True，那么将用相应的开发人员来运行代码。


```py
async def startup(
    idea: str,
    investment: float = 3.0,
    n_round: int = 5,
    code_review: bool = False,
    run_tests: bool = False,
    implement: bool = True,
):
    """Run a startup. Be a boss."""
    company = SoftwareCompany()
    company.hire(
        [
            ProductManager(),
            Architect(),
            ProjectManager(),
        ]
    )

    # if implement or code_review
    if implement or code_review:
        # developing features: implement the idea
        company.hire([Engineer(n_borg=5, use_code_review=code_review)])

    if run_tests:
        # developing features: run tests on the spot and identify bugs
        # (bug fixing capability comes soon!)
        company.hire([QaEngineer()])

    company.invest(investment)
    company.start_project(idea)
    await company.run(n_round=n_round)


```

这段代码定义了一个名为 `main` 的函数，它接受一些参数并返回结果。函数的作用是启动一个 AI 公司的最小轻量级版本，使用户能够投资于这个公司并资助他们的创新项目。

具体来说，这段代码的作用如下：

1. 接受参数 `idea`、`investment`、`n_round` 和 `code_review`，它们分别是创新项目的想法、投资金额、测试循环次数和代码审核选项。
2. 通过调用 `startup` 函数，初始化这些参数。这个函数使用 `asyncio` 包提供的高级非阻塞编程技术，可以让它立即返回并等待结果，而不是在每次循环结束后才返回。
3. 通过调用 `asyncio.run` 函数，让 `startup` 函数返回一个协程对象，这个对象代表一个任务，会在提交时执行。
4. 通过调用 `startup` 函数中的 `idea` 参数，将创新项目的想法保存到 `idea` 协程变量中。
5. 通过调用 `startup` 函数中的 `investment` 参数，设置投资金额。
6. 通过调用 `startup` 函数中的 `n_round` 参数，设置测试循环次数。
7. 通过调用 `startup` 函数中的 `code_review` 参数，设置是否使用代码审核。
8. 通过调用 `startup` 函数中的 `run_tests` 参数，设置是否运行测试。
9. 通过调用 `startup` 函数中的 `implement` 参数，设置是否实现创新项目。
10. 通过调用 `asyncio.run` 函数中的 `startup` 函数，提交 `idea` 协程变量，并启动公司。


```py
def main(
    idea: str,
    investment: float = 3.0,
    n_round: int = 5,
    code_review: bool = True,
    run_tests: bool = False,
    implement: bool = True,
):
    """
    We are a software startup comprised of AI. By investing in us,
    you are empowering a future filled with limitless possibilities.
    :param idea: Your innovative idea, such as "Creating a snake game."
    :param investment: As an investor, you have the opportunity to contribute
    a certain dollar amount to this AI company.
    :param n_round:
    :param code_review: Whether to use code review.
    :return:
    """
    asyncio.run(startup(idea, investment, n_round, code_review, run_tests, implement))


```

这段代码是在 Python 脚本中，如果脚本被运行为单独的环境(如作为交互式shell)，则会导致代码中的 `if __name__ == "__main__":` 语句永远无法执行，因为该代码块会检查 `__name__` 是否与 `__main__` 相等，而在交互式环境中，该检查不会始终生效。

因此，这段代码的作用是确保只有在程序被单独运行时，才会执行 `fire.Fire(main)` 这一行代码。换句话说，这段代码会防止脚本在运行时被意外地调用，从而确保程序的安全性和稳定性。


```py
if __name__ == "__main__":
    fire.Fire(main)

```

# Dev container

This project includes a [dev container](https://containers.dev/), which lets you use a container as a full-featured dev environment.

You can use the dev container configuration in this folder to build and start running MetaGPT locally! For more, refer to the main README under the home directory. 
You can use it in [GitHub Codespaces](https://github.com/features/codespaces) or the [VS Code Dev Containers extension](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers).

## GitHub Codespaces
<a href="https://codespaces.new/geekan/MetaGPT"><img src="https://github.com/codespaces/badge.svg" alt="Open in GitHub Codespaces"></a>

You may use the button above to open this repo in a Codespace

For more info, check out the [GitHub documentation](https://docs.github.com/en/free-pro-team@latest/github/developing-online-with-codespaces/creating-a-codespace#creating-a-codespace).
  
## VS Code Dev Containers
<a href="https://vscode.dev/redirect?url=vscode://ms-vscode-remote.remote-containers/cloneInVolume?url=https://github.com/geekan/MetaGPT"><img src="https://img.shields.io/static/v1?label=Dev%20Containers&message=Open&color=blue&logo=visualstudiocode" alt="Open in Dev Containers"></a>

Note: If you click this link you will open the main repo and not your local cloned repo, you can use this link and replace with your username and cloned repo name: 
https://vscode.dev/redirect?url=vscode://ms-vscode-remote.remote-containers/cloneInVolume?url=https://github.com/geekan/MetaGPT


If you already have VS Code and Docker installed, you can use the button above to get started. This will cause VS Code to automatically install the Dev Containers extension if needed, clone the source code into a container volume, and spin up a dev container for use.

You can also follow these steps to open this repo in a container using the VS Code Dev Containers extension:

1. If this is your first time using a development container, please ensure your system meets the pre-reqs (i.e. have Docker installed) in the [getting started steps](https://aka.ms/vscode-remote/containers/getting-started).

2. Open a locally cloned copy of the code:

   - Fork and Clone this repository to your local filesystem.
   - Press <kbd>F1</kbd> and select the **Dev Containers: Open Folder in Container...** command.
   - Select the cloned copy of this folder, wait for the container to start, and try things out!

You can learn more in the [Dev Containers documentation](https://code.visualstudio.com/docs/devcontainers/containers).

## Tips and tricks

* If you are working with the same repository folder in a container and Windows, you'll want consistent line endings (otherwise you may see hundreds of changes in the SCM view). The `.gitattributes` file in the root of this repo will disable line ending conversion and should prevent this. See [tips and tricks](https://code.visualstudio.com/docs/devcontainers/tips-and-tricks#_resolving-git-line-ending-issues-in-containers-resulting-in-many-modified-files) for more info.
* If you'd like to review the contents of the image used in this dev container, you can check it out in the [devcontainers/images](https://github.com/devcontainers/images/tree/main/src/python) repo.


Our vision is to [extend human life](https://github.com/geekan/HowToLiveLonger) and [reduce working hours](https://github.com/geekan/MetaGPT/).

1.  ### Convenient Link for Sharing this Document:

```py
- MetaGPT-Index/FAQ https://deepwisdom.feishu.cn/wiki/MsGnwQBjiif9c3koSJNcYaoSnu4
```

2.  ### Link

<!---->

1.  Code：https://github.com/geekan/MetaGPT

1.  Roadmap：https://github.com/geekan/MetaGPT/blob/main/docs/ROADMAP.md

1.  EN

    1.  Demo Video: [MetaGPT: Multi-Agent AI Programming Framework](https://www.youtube.com/watch?v=8RNzxZBTW8M)
    2. Tutorial: [MetaGPT: Deploy POWERFUL Autonomous Ai Agents BETTER Than SUPERAGI!](https://www.youtube.com/watch?v=q16Gi9pTG_M&t=659s)
    3. Author's thoughts video(EN): [MetaGPT Matthew Berman](https://youtu.be/uT75J_KG_aY?si=EgbfQNAwD8F5Y1Ak)

1.  CN

    1.  Demo Video: [MetaGPT：一行代码搭建你的虚拟公司_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1NP411C7GW/?spm_id_from=333.999.0.0&vd_source=735773c218b47da1b4bd1b98a33c5c77)
    1.  Tutorial: [一个提示词写游戏 Flappy bird, 比AutoGPT强10倍的MetaGPT，最接近AGI的AI项目](https://youtu.be/Bp95b8yIH5c)
    2.   Author's thoughts video(CN): [MetaGPT作者深度解析直播回放_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1Ru411V7XL/?spm_id_from=333.337.search-card.all.click)
  
<!---->

3.  ### How to become a contributor?

<!---->

1.  Choose a task from the Roadmap (or you can propose one). By submitting a PR, you can become a contributor and join the dev team.
1.  Current contributors come from backgrounds including ByteDance AI Lab/DingDong/Didi/Xiaohongshu, Tencent/Baidu/MSRA/TikTok/BloomGPT Infra/Bilibili/CUHK/HKUST/CMU/UCB

<!---->

4.  ### Chief Evangelist (Monthly Rotation)

MetaGPT Community - The position of Chief Evangelist rotates on a monthly basis. The primary responsibilities include:

1.  Maintaining community FAQ documents, announcements, and Github resources/READMEs.
1.  Responding to, answering, and distributing community questions within an average of 30 minutes, including on platforms like Github Issues, Discord and WeChat.
1.  Upholding a community atmosphere that is enthusiastic, genuine, and friendly.
1.  Encouraging everyone to become contributors and participate in projects that are closely related to achieving AGI (Artificial General Intelligence).
1.  (Optional) Organizing small-scale events, such as hackathons.

<!---->

5.  ### FAQ

<!---->

1.  Experience with the generated repo code:

    1.  https://github.com/geekan/MetaGPT/releases/tag/v0.1.0

1.  Code truncation/ Parsing failure:

    1.  Check if it's due to exceeding length. Consider using the gpt-3.5-turbo-16k or other long token versions.

1.  Success rate:

    1.  There hasn't been a quantitative analysis yet, but the success rate of code generated by GPT-4 is significantly higher than that of gpt-3.5-turbo.

1.  Support for incremental, differential updates (if you wish to continue a half-done task):

    1.  Several prerequisite tasks are listed on the ROADMAP.

1.  Can existing code be loaded?

    1.  It's not on the ROADMAP yet, but there are plans in place. It just requires some time.

1.  Support for multiple programming languages and natural languages?

    1.  It's listed on ROADMAP.

1.  Want to join the contributor team? How to proceed?

    1.  Merging a PR will get you into the contributor's team. The main ongoing tasks are all listed on the ROADMAP.

1.  PRD stuck / unable to access/ connection interrupted

    1.  The official OPENAI_API_BASE address is `https://api.openai.com/v1`
    1.  If the official OPENAI_API_BASE address is inaccessible in your environment (this can be verified with curl), it's recommended to configure using the reverse proxy OPENAI_API_BASE provided by libraries such as openai-forward. For instance, `OPENAI_API_BASE: "``https://api.openai-forward.com/v1``"`
    1.  If the official OPENAI_API_BASE address is inaccessible in your environment (again, verifiable via curl), another option is to configure the OPENAI_PROXY parameter. This way, you can access the official OPENAI_API_BASE via a local proxy. If you don't need to access via a proxy, please do not enable this configuration; if accessing through a proxy is required, modify it to the correct proxy address. Note that when OPENAI_PROXY is enabled, don't set OPENAI_API_BASE.
    1.  Note: OpenAI's default API design ends with a v1. An example of the correct configuration is: `OPENAI_API_BASE: "``https://api.openai.com/v1``"`

1.  Absolutely! How can I assist you today?

    1.  Did you use Chi or a similar service? These services are prone to errors, and it seems that the error rate is higher when consuming 3.5k-4k tokens in GPT-4

1.  What does Max token mean?

    1.  It's a configuration for OpenAI's maximum response length. If the response exceeds the max token, it will be truncated.

1.  How to change the investment amount?

    1.  You can view all commands by typing `python startup.py --help`

1.  Which version of Python is more stable?

    1.  python3.9 / python3.10

1.  Can't use GPT-4, getting the error "The model gpt-4 does not exist."

    1.  OpenAI's official requirement: You can use GPT-4 only after spending $1 on OpenAI.
    1.  Tip: Run some data with gpt-3.5-turbo (consume the free quota and $1), and then you should be able to use gpt-4.

1.  Can games whose code has never been seen before be written?

    1.  Refer to the README. The recommendation system of Toutiao is one of the most complex systems in the world currently. Although it's not on GitHub, many discussions about it exist online. If it can visualize these, it suggests it can also summarize these discussions and convert them into code. The prompt would be something like "write a recommendation system similar to Toutiao". Note: this was approached in earlier versions of the software. The SOP of those versions was different; the current one adopts Elon Musk's five-step work method, emphasizing trimming down requirements as much as possible.

1.  Under what circumstances would there typically be errors?

    1.  More than 500 lines of code: some function implementations may be left blank.
    1.  When using a database, it often gets the implementation wrong — since the SQL database initialization process is usually not in the code.
    1.  With more lines of code, there's a higher chance of false impressions, leading to calls to non-existent APIs.

1.  Instructions for using SD Skills/UI Role:

    1.  Currently, there is a test script located in /tests/metagpt/roles. The file ui_role provides the corresponding code implementation. For testing, you can refer to the test_ui in the same directory.

    1.  The UI role takes over from the product manager role, extending the output from the 【UI Design draft】 provided by the product manager role. The UI role has implemented the UIDesign Action. Within the run of UIDesign, it processes the respective context, and based on the set template, outputs the UI. The output from the UI role includes:

        1.  UI Design Description: Describes the content to be designed and the design objectives.
        1.  Selected Elements： Describes the elements in the design that need to be illustrated.
        1.  HTML Layout： Outputs the HTML code for the page.
        1.  CSS Styles (styles.css)： Outputs the CSS code for the page.

    1.  Currently, the SD skill is a tool invoked by UIDesign. It instantiates the SDEngine, with specific code found in metagpt/tools/sd_engine.

    1.  Configuration instructions for SD Skills: The SD interface is currently deployed based on *https://github.com/AUTOMATIC1111/stable-diffusion-webui* **For environmental configurations and model downloads, please refer to the aforementioned GitHub repository. To initiate the SD service that supports API calls, run the command specified in cmd with the parameter nowebui, i.e.,

        1.  > python webui.py --enable-insecure-extension-access --port xxx --no-gradio-queue --nowebui
        1.      Once it runs without errors, the interface will be accessible after approximately 1 minute when the model finishes loading.
        1.  Configure SD_URL and SD_T2I_API in the config.yaml/key.yaml files.
        1.  ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/065295a67b0b4feea665d1372722d49d~tplv-k3u1fbpfcp-zoom-1.image)
        1.      SD_URL is the deployed server/machine IP, and Port is the specified port above, defaulting to 7860.
        1.  > SD_URL: IP:Port

1.  An error occurred during installation: "Another program is using this file...egg".

    1.  Delete the file and try again.
    1.  Or manually execute`pip install -r requirements.txt`

1.  The origin of the name MetaGPT？

    1.  The name was derived after iterating with GPT-4 over a dozen rounds. GPT-4 scored and suggested it.

1.  Is there a more step-by-step installation tutorial?

    1.  Youtube（CN）：[一个提示词写游戏 Flappy bird, 比AutoGPT强10倍的MetaGPT，最接近AGI的AI项目=一个软件公司产品经理+程序员](https://youtu.be/Bp95b8yIH5c)
    1.  Youtube（EN）https://www.youtube.com/watch?v=q16Gi9pTG_M&t=659s
    2.  video(EN): [MetaGPT Matthew Berman](https://youtu.be/uT75J_KG_aY?si=EgbfQNAwD8F5Y1Ak)

1.  openai.error.RateLimitError: You exceeded your current quota, please check your plan and billing details

    1.  If you haven't exhausted your free quota, set RPM to 3 or lower in the settings.
    1.  If your free quota is used up, consider adding funds to your account.

1.  What does "borg" mean in n_borg?

    1.  [Wikipedia borg meaning ](https://en.wikipedia.org/wiki/Borg)
    1.  The Borg civilization operates based on a hive or collective mentality, known as "the Collective." Every Borg individual is connected to the collective via a sophisticated subspace network, ensuring continuous oversight and guidance for every member. This collective consciousness allows them to not only "share the same thoughts" but also to adapt swiftly to new strategies. While individual members of the collective rarely communicate, the collective "voice" sometimes transmits aboard ships.

1.  How to use the Claude API？

    1.  The full implementation of the Claude API is not provided in the current code.
    1.  You can use the Claude API through third-party API conversion projects like: https://github.com/jtsang4/claude-to-chatgpt

1.  Is Llama2 supported？

    1.  On the day Llama2 was released, some of the community members began experiments and found that output can be generated based on MetaGPT's structure. However, Llama2's context is too short to generate a complete project. Before regularly using Llama2, it's necessary to expand the context window to at least 8k. If anyone has good recommendations for expansion models or methods, please leave a comment.

1.  `mermaid-cli getElementsByTagName SyntaxError: Unexpected token '.'`

    1.  Upgrade node to version 14.x or above:

        1.  `npm install -g n`
        1.  `n stable` to install the stable version of node（v18.x）


# MetaGPT: 多智能体框架

<p align="center">
<a href=""><img src="resources/MetaGPT-new-log.png" alt="MetaGPT logo: 使 GPT 以软件公司的形式工作，协作处理更复杂的任务" width="150px"></a>
</p>

<p align="center">
<b>使 GPTs 组成软件公司，协作处理更复杂的任务</b>
</p>

<p align="center">
<a href="docs/README_CN.md"><img src="https://img.shields.io/badge/文档-中文版-blue.svg" alt="CN doc"></a>
<a href="README.md"><img src="https://img.shields.io/badge/document-English-blue.svg" alt="EN doc"></a>
<a href="docs/README_JA.md"><img src="https://img.shields.io/badge/ドキュメント-日本語-blue.svg" alt="JA doc"></a>
<a href="https://discord.gg/wCp6Q3fsAk"><img src="https://img.shields.io/badge/Discord-Join-blue?logo=discord&logoColor=white&color=blue" alt="Discord Follow"></a>
<a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License: MIT"></a>
<a href="docs/ROADMAP.md"><img src="https://img.shields.io/badge/ROADMAP-路线图-blue" alt="roadmap"></a>
<a href="https://twitter.com/MetaGPT_"><img src="https://img.shields.io/twitter/follow/MetaGPT?style=social" alt="Twitter Follow"></a>
</p>

<p align="center">
   <a href="https://airtable.com/appInfdG0eJ9J4NNL/shrEd9DrwVE3jX6oz"><img src="https://img.shields.io/badge/AgentStore-Waitlist-ffc107?logoColor=white" alt="AgentStore Waitlist"></a>
   <a href="https://vscode.dev/redirect?url=vscode://ms-vscode-remote.remote-containers/cloneInVolume?url=https://github.com/geekan/MetaGPT"><img src="https://img.shields.io/static/v1?label=Dev%20Containers&message=Open&color=blue&logo=visualstudiocode" alt="Open in Dev Containers"></a>
   <a href="https://codespaces.new/geekan/MetaGPT"><img src="https://img.shields.io/badge/Github_Codespace-Open-blue?logo=github" alt="Open in GitHub Codespaces"></a>
   <a href="https://huggingface.co/spaces/deepwisdom/MetaGPT" target="_blank"><img alt="Hugging Face" src="https://img.shields.io/badge/%F0%9F%A4%97%20-Hugging%20Face-blue?color=blue&logoColor=white" /></a>
</p>

1. MetaGPT输入**一句话的老板需求**，输出**用户故事 / 竞品分析 / 需求 / 数据结构 / APIs / 文件等**
2. MetaGPT内部包括**产品经理 / 架构师 / 项目经理 / 工程师**，它提供了一个**软件公司**的全过程与精心调配的SOP
   1. `Code = SOP(Team)` 是核心哲学。我们将SOP具象化，并且用于LLM构成的团队

![一个完全由大语言模型角色构成的软件公司](resources/software_company_cd.jpeg)

<p align="center">软件公司多角色示意图（正在逐步实现）</p>

## MetaGPT 的能力

https://github.com/geekan/MetaGPT/assets/34952977/34345016-5d13-489d-b9f9-b82ace413419


## 示例（均由 GPT-4 生成）

例如，键入`python startup.py "写个类似今日头条的推荐系统"`并回车，你会获得一系列输出，其一是数据结构与API设计

![今日头条 Recsys 数据 & API 设计](resources/workspace/content_rec_sys/resources/data_api_design.png)

这需要大约**0.2美元**（GPT-4 API的费用）来生成一个带有分析和设计的示例，大约2.0美元用于一个完整的项目

## 安装

### 传统安装

```pybash
# 第 1 步：确保您的系统上安装了 NPM。并使用npm安装mermaid-js
npm --version
sudo npm install -g @mermaid-js/mermaid-cli

# 第 2 步：确保您的系统上安装了 Python 3.9+。您可以使用以下命令进行检查：
python --version

# 第 3 步：克隆仓库到您的本地机器，并进行安装。
git clone https://github.com/geekan/metagpt
cd metagpt
pip install -e.
```

**注意：**

- 如果已经安装了Chrome、Chromium或MS Edge，可以通过将环境变量`PUPPETEER_SKIP_CHROMIUM_DOWNLOAD`设置为`true`来跳过下载Chromium。

- 一些人在全局安装此工具时遇到问题。在本地安装是替代解决方案，

    ```pybash
    npm install @mermaid-js/mermaid-cli
    ```

- 不要忘记在config.yml中为mmdc配置配置，

    ```pyyml
    PUPPETEER_CONFIG: "./config/puppeteer-config.json"
    MMDC: "./node_modules/.bin/mmdc"
    ```

- 如果`pip install -e.`失败并显示错误`[Errno 13] Permission denied: '/usr/local/lib/python3.11/dist-packages/test-easy-install-13129.write-test'`，请尝试使用`pip install -e. --user`运行。

### Docker安装

```pybash
# 步骤1: 下载metagpt官方镜像并准备好config.yaml
docker pull metagpt/metagpt:latest
mkdir -p /opt/metagpt/{config,workspace}
docker run --rm metagpt/metagpt:latest cat /app/metagpt/config/config.yaml > /opt/metagpt/config/key.yaml
vim /opt/metagpt/config/key.yaml # 修改配置文件

# 步骤2: 使用容器运行metagpt演示
docker run --rm \
    --privileged \
    -v /opt/metagpt/config/key.yaml:/app/metagpt/config/key.yaml \
    -v /opt/metagpt/workspace:/app/metagpt/workspace \
    metagpt/metagpt:latest \
    python startup.py "Write a cli snake game"

# 您也可以启动一个容器并在其中执行命令
docker run --name metagpt -d \
    --privileged \
    -v /opt/metagpt/config/key.yaml:/app/metagpt/config/key.yaml \
    -v /opt/metagpt/workspace:/app/metagpt/workspace \
    metagpt/metagpt:latest

docker exec -it metagpt /bin/bash
$ python startup.py "Write a cli snake game"
```

`docker run ...`做了以下事情:

- 以特权模式运行，有权限运行浏览器
- 将主机文件 `/opt/metagpt/config/key.yaml` 映射到容器文件 `/app/metagpt/config/key.yaml`
- 将主机目录 `/opt/metagpt/workspace` 映射到容器目录 `/app/metagpt/workspace`
- 执行示例命令 `python startup.py "Write a cli snake game"`

### 自己构建镜像

```pybash
# 您也可以自己构建metagpt镜像
git clone https://github.com/geekan/MetaGPT.git
cd MetaGPT && docker build -t metagpt:custom .
```

## 配置

- 在 `config/key.yaml / config/config.yaml / env` 中配置您的 `OPENAI_API_KEY`
- 优先级顺序：`config/key.yaml > config/config.yaml > env`

```pybash
# 复制配置文件并进行必要的修改
cp config/config.yaml config/key.yaml
```

| 变量名                              | config/key.yaml                           | env                                             |
| ----------------------------------- | ----------------------------------------- | ----------------------------------------------- |
| OPENAI_API_KEY # 用您自己的密钥替换 | OPENAI_API_KEY: "sk-..."                  | export OPENAI_API_KEY="sk-..."                  |
| OPENAI_API_BASE # 可选              | OPENAI_API_BASE: "https://<YOUR_SITE>/v1" | export OPENAI_API_BASE="https://<YOUR_SITE>/v1" |

## 示例：启动一个创业公司

```pyshell
python startup.py "写一个命令行贪吃蛇"
# 开启code review模式会花费更多的金钱, 但是会提升代码质量和成功率
python startup.py "写一个命令行贪吃蛇" --code_review True
```

运行脚本后，您可以在 `workspace/` 目录中找到您的新项目。
### 平台或工具的倾向性
可以在阐述需求时说明想要使用的平台或工具。
例如：
```pyshell
python startup.py "写一个基于pygame的命令行贪吃蛇"
```

### 使用

```py
名称
    startup.py - 我们是一家AI软件创业公司。通过投资我们，您将赋能一个充满无限可能的未来。

概要
    startup.py IDEA <flags>

描述
    我们是一家AI软件创业公司。通过投资我们，您将赋能一个充满无限可能的未来。

位置参数
    IDEA
        类型: str
        您的创新想法，例如"写一个命令行贪吃蛇。"

标志
    --investment=INVESTMENT
        类型: float
        默认值: 3.0
        作为投资者，您有机会向这家AI公司投入一定的美元金额。
    --n_round=N_ROUND
        类型: int
        默认值: 5

备注
    您也可以用`标志`的语法，来处理`位置参数`
```

### 代码实现

```pypython
from metagpt.software_company import SoftwareCompany
from metagpt.roles import ProjectManager, ProductManager, Architect, Engineer

async def startup(idea: str, investment: float = 3.0, n_round: int = 5):
    """运行一个创业公司。做一个老板"""
    company = SoftwareCompany()
    company.hire([ProductManager(), Architect(), ProjectManager(), Engineer()])
    company.invest(investment)
    company.start_project(idea)
    await company.run(n_round=n_round)
```

你可以查看`examples`，其中有单角色（带知识库）的使用例子与仅LLM的使用例子。

## 快速体验
对一些用户来说，安装配置本地环境是有困难的，下面这些教程能够让你快速体验到MetaGPT的魅力。  

- [MetaGPT快速体验](https://deepwisdom.feishu.cn/wiki/Q8ycw6J9tiNXdHk66MRcIN8Pnlg)

可直接在Huggingface Space体验

- https://huggingface.co/spaces/deepwisdom/MetaGPT

## 联系信息

如果您对这个项目有任何问题或反馈，欢迎联系我们。我们非常欢迎您的建议！

- **邮箱：** alexanderwu@fuzhi.ai
- **GitHub 问题：** 对于更技术性的问题，您也可以在我们的 [GitHub 仓库](https://github.com/geekan/metagpt/issues) 中创建一个新的问题。

我们会在2-3个工作日内回复所有问题。

## 演示

https://github.com/geekan/MetaGPT/assets/2707039/5e8c1062-8c35-440f-bb20-2b0320f8d27d

## 加入我们

📢 加入我们的Discord频道！
https://discord.gg/ZRHeExS6xv

期待在那里与您相见！🎉


# MetaGPT: マルチエージェントフレームワーク

<p align="center">
<a href=""><img src="resources/MetaGPT-new-log.png" alt="MetaGPT ロゴ: GPT がソフトウェア会社で働けるようにし、協力してより複雑な仕事に取り組む。" width="150px"></a>
</p>

<p align="center">
<b>GPT にさまざまな役割を割り当てることで、複雑なタスクのための共同ソフトウェアエンティティを形成します。</b>
</p>

<p align="center">
<a href="docs/README_CN.md"><img src="https://img.shields.io/badge/文档-中文版-blue.svg" alt="CN doc"></a>
<a href="README.md"><img src="https://img.shields.io/badge/document-English-blue.svg" alt="EN doc"></a>
<a href="docs/README_JA.md"><img src="https://img.shields.io/badge/ドキュメント-日本語-blue.svg" alt="JA doc"></a>
<a href="https://discord.gg/wCp6Q3fsAk"><img src="https://img.shields.io/badge/Discord-Join-blue?logo=discord&logoColor=white&color=blue" alt="Discord Follow"></a>
<a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License: MIT"></a>
<a href="docs/ROADMAP.md"><img src="https://img.shields.io/badge/ROADMAP-路线图-blue" alt="roadmap"></a>
<a href="https://twitter.com/MetaGPT_"><img src="https://img.shields.io/twitter/follow/MetaGPT?style=social" alt="Twitter Follow"></a>
</p>

<p align="center">
   <a href="https://airtable.com/appInfdG0eJ9J4NNL/shrEd9DrwVE3jX6oz"><img src="https://img.shields.io/badge/AgentStore-Waitlist-ffc107?logoColor=white" alt="AgentStore Waitlist"></a>
   <a href="https://vscode.dev/redirect?url=vscode://ms-vscode-remote.remote-containers/cloneInVolume?url=https://github.com/geekan/MetaGPT"><img src="https://img.shields.io/static/v1?label=Dev%20Containers&message=Open&color=blue&logo=visualstudiocode" alt="Open in Dev Containers"></a>
   <a href="https://codespaces.new/geekan/MetaGPT"><img src="https://img.shields.io/badge/Github_Codespace-Open-blue?logo=github" alt="Open in GitHub Codespaces"></a>
   <a href="https://huggingface.co/spaces/deepwisdom/MetaGPT" target="_blank"><img alt="Hugging Face" src="https://img.shields.io/badge/%F0%9F%A4%97%20-Hugging%20Face-blue?color=blue&logoColor=white" /></a>
</p>

1. MetaGPT は、**1 行の要件** を入力とし、**ユーザーストーリー / 競合分析 / 要件 / データ構造 / API / 文書など** を出力します。
2. MetaGPT には、**プロダクト マネージャー、アーキテクト、プロジェクト マネージャー、エンジニア** が含まれています。MetaGPT は、**ソフトウェア会社のプロセス全体を、慎重に調整された SOP とともに提供します。**
   1. `Code = SOP(Team)` が基本理念です。私たちは SOP を具体化し、LLM で構成されるチームに適用します。

![ソフトウェア会社は LLM ベースの役割で構成されている](resources/software_company_cd.jpeg)

<p align="center">ソフトウェア会社のマルチロール図式（順次導入）</p>

## MetaGPT の能力


https://github.com/geekan/MetaGPT/assets/34952977/34345016-5d13-489d-b9f9-b82ace413419



## 例（GPT-4 で完全生成）

例えば、`python startup.py "Toutiao のような RecSys をデザインする"`と入力すると、多くの出力が得られます

![Jinri Toutiao Recsys データと API デザイン](resources/workspace/content_rec_sys/resources/data_api_design.png)

解析と設計を含む 1 つの例を生成するのに約 **$0.2**（GPT-4 の API 使用料）、完全なプロジェクトでは約 **$2.0** かかります。




## インストール

### インストールビデオガイド

- [Matthew Berman: How To Install MetaGPT - Build A Startup With One Prompt!!](https://youtu.be/uT75J_KG_aY)

### 伝統的なインストール

```pybash
# ステップ 1: NPM がシステムにインストールされていることを確認してください。次に mermaid-js をインストールします。(お使いのコンピューターに npm がない場合は、Node.js 公式サイトで Node.js https://nodejs.org/ をインストールしてください。）
npm --version
sudo npm install -g @mermaid-js/mermaid-cli

# ステップ 2: Python 3.9+ がシステムにインストールされていることを確認してください。これを確認するには:
python --version

# ステップ 3: リポジトリをローカルマシンにクローンし、インストールする。
git clone https://github.com/geekan/metagpt
cd metagpt
pip install -e.
```

**注:**

- すでに Chrome、Chromium、MS Edge がインストールされている場合は、環境変数 `PUPPETEER_SKIP_CHROMIUM_DOWNLOAD` を `true` に設定することで、
Chromium のダウンロードをスキップすることができます。

- このツールをグローバルにインストールする[問題を抱えている](https://github.com/mermaidjs/mermaid.cli/issues/15)人もいます。ローカルにインストールするのが代替の解決策です、

  ```pybash
  npm install @mermaid-js/mermaid-cli
  ```

- config.yml に mmdc のコンフィグを記述するのを忘れないこと

  ```pyyml
  PUPPETEER_CONFIG: "./config/puppeteer-config.json"
  MMDC: "./node_modules/.bin/mmdc"
  ```

- もし `pip install -e.` がエラー `[Errno 13] Permission denied: '/usr/local/lib/python3.11/dist-packages/test-easy-install-13129.write-test'` で失敗したら、代わりに `pip install -e. --user` を実行してみてください

- Mermaid charts を SVG、PNG、PDF 形式に変換します。Node.js 版の Mermaid-CLI に加えて、Python 版の Playwright、pyppeteer、または mermaid.ink をこのタスクに使用できるようになりました。

  - Playwright
    - **Playwright のインストール**

    ```pybash
    pip install playwright
    ```

    - **必要なブラウザのインストール**

    PDF変換をサポートするには、Chrominumをインストールしてください。

    ```pybash
    playwright install --with-deps chromium
    ```

    - **modify `config.yaml`**

    config.yaml から MERMAID_ENGINE のコメントを外し、`playwright` に変更する

    ```pyyaml
    MERMAID_ENGINE: playwright
    ```

  - pyppeteer
    - **pyppeteer のインストール**

    ```pybash
    pip install pyppeteer
    ```

    - **自分のブラウザを使用**

    pyppeteer を使えばインストールされているブラウザを使うことができます、以下の環境を設定してください

    ```pybash
    export PUPPETEER_EXECUTABLE_PATH = /path/to/your/chromium or edge or chrome
    ```

    ブラウザのインストールにこのコマンドを使わないでください、これは古すぎます

    ```pybash
    pyppeteer-install
    ```

    - **`config.yaml` を修正**

    config.yaml から MERMAID_ENGINE のコメントを外し、`pyppeteer` に変更する

    ```pyyaml
    MERMAID_ENGINE: pyppeteer
    ```

  - mermaid.ink
    - **`config.yaml` を修正**

    config.yaml から MERMAID_ENGINE のコメントを外し、`ink` に変更する

    ```pyyaml
    MERMAID_ENGINE: ink
    ```

    注: この方法は pdf エクスポートに対応していません。

### Docker によるインストール

```pybash
# ステップ 1: metagpt 公式イメージをダウンロードし、config.yaml を準備する
docker pull metagpt/metagpt:latest
mkdir -p /opt/metagpt/{config,workspace}
docker run --rm metagpt/metagpt:latest cat /app/metagpt/config/config.yaml > /opt/metagpt/config/key.yaml
vim /opt/metagpt/config/key.yaml # 設定を変更する

# ステップ 2: コンテナで metagpt デモを実行する
docker run --rm \
    --privileged \
    -v /opt/metagpt/config/key.yaml:/app/metagpt/config/key.yaml \
    -v /opt/metagpt/workspace:/app/metagpt/workspace \
    metagpt/metagpt:latest \
    python startup.py "Write a cli snake game"

# コンテナを起動し、その中でコマンドを実行することもできます
docker run --name metagpt -d \
    --privileged \
    -v /opt/metagpt/config/key.yaml:/app/metagpt/config/key.yaml \
    -v /opt/metagpt/workspace:/app/metagpt/workspace \
    metagpt/metagpt:latest

docker exec -it metagpt /bin/bash
$ python startup.py "Write a cli snake game"
```

コマンド `docker run ...` は以下のことを行います:

- 特権モードで実行し、ブラウザの実行権限を得る
- ホスト設定ファイル `/opt/metagpt/config/key.yaml` をコンテナ `/app/metagpt/config/key.yaml` にマップします
- ホストディレクトリ `/opt/metagpt/workspace` をコンテナディレクトリ `/app/metagpt/workspace` にマップするs
- デモコマンド `python startup.py "Write a cli snake game"` を実行する

### 自分でイメージをビルドする

```pybash
# また、自分で metagpt イメージを構築することもできます。
git clone https://github.com/geekan/MetaGPT.git
cd MetaGPT && docker build -t metagpt:custom .
```

## 設定

- `OPENAI_API_KEY` を `config/key.yaml / config/config.yaml / env` のいずれかで設定します。
- 優先順位は: `config/key.yaml > config/config.yaml > env` の順です。

```pybash
# 設定ファイルをコピーし、必要な修正を加える。
cp config/config.yaml config/key.yaml
```

| 変数名                                  | config/key.yaml                           | env                                             |
| --------------------------------------- | ----------------------------------------- | ----------------------------------------------- |
| OPENAI_API_KEY # 自分のキーに置き換える | OPENAI_API_KEY: "sk-..."                  | export OPENAI_API_KEY="sk-..."                  |
| OPENAI_API_BASE # オプション            | OPENAI_API_BASE: "https://<YOUR_SITE>/v1" | export OPENAI_API_BASE="https://<YOUR_SITE>/v1" |

## チュートリアル: スタートアップの開始

```pyshell
# スクリプトの実行
python startup.py "Write a cli snake game"
# プロジェクトの実施にエンジニアを雇わないこと
python startup.py "Write a cli snake game" --implement False
# エンジニアを雇い、コードレビューを行う
python startup.py "Write a cli snake game" --code_review True
```

スクリプトを実行すると、`workspace/` ディレクトリに新しいプロジェクトが見つかります。

### プラットフォームまたはツールの設定

要件を述べるときに、どのプラットフォームまたはツールを使用するかを指定できます。

```pyshell
python startup.py "pygame をベースとした cli ヘビゲームを書く"
```

### 使用方法

```py
会社名
    startup.py - 私たちは AI で構成されたソフトウェア・スタートアップです。私たちに投資することは、無限の可能性に満ちた未来に力を与えることです。

シノプシス
    startup.py IDEA <flags>

説明
    私たちは AI で構成されたソフトウェア・スタートアップです。私たちに投資することは、無限の可能性に満ちた未来に力を与えることです。

位置引数
    IDEA
        型: str
        あなたの革新的なアイデア、例えば"スネークゲームを作る。"など

フラグ
    --investment=INVESTMENT
        型: float
        デフォルト: 3.0
        投資家として、あなたはこの AI 企業に一定の金額を拠出する機会がある。
    --n_round=N_ROUND
        型: int
        デフォルト: 5

注意事項
    位置引数にフラグ構文を使うこともできます
```

### コードウォークスルー

```pypython
from metagpt.software_company import SoftwareCompany
from metagpt.roles import ProjectManager, ProductManager, Architect, Engineer

async def startup(idea: str, investment: float = 3.0, n_round: int = 5):
    """スタートアップを実行する。ボスになる。"""
    company = SoftwareCompany()
    company.hire([ProductManager(), Architect(), ProjectManager(), Engineer()])
    company.invest(investment)
    company.start_project(idea)
    await company.run(n_round=n_round)
```

`examples` でシングル・ロール（ナレッジ・ベース付き）と LLM のみの例を詳しく見ることができます。

## クイックスタート

ローカル環境のインストールや設定は、ユーザーによっては難しいものです。以下のチュートリアルで MetaGPT の魅力をすぐに体験できます。

- [MetaGPT クイックスタート](https://deepwisdom.feishu.cn/wiki/CyY9wdJc4iNqArku3Lncl4v8n2b)

Hugging Face Space で試す
- https://huggingface.co/spaces/deepwisdom/MetaGPT

## 引用

現時点では、[Arxiv 論文](https://arxiv.org/abs/2308.00352)を引用してください:

```pybibtex
@misc{hong2023metagpt,
      title={MetaGPT: Meta Programming for Multi-Agent Collaborative Framework},
      author={Sirui Hong and Xiawu Zheng and Jonathan Chen and Yuheng Cheng and Jinlin Wang and Ceyao Zhang and Zili Wang and Steven Ka Shing Yau and Zijuan Lin and Liyang Zhou and Chenyu Ran and Lingfeng Xiao and Chenglin Wu},
      year={2023},
      eprint={2308.00352},
      archivePrefix={arXiv},
      primaryClass={cs.AI}
}
```

## お問い合わせ先

このプロジェクトに関するご質問やご意見がございましたら、お気軽にお問い合わせください。皆様のご意見をお待ちしております！

- **Email:** alexanderwu@fuzhi.ai
- **GitHub Issues:** 技術的なお問い合わせについては、[GitHub リポジトリ](https://github.com/geekan/metagpt/issues) に新しい issue を作成することもできます。

ご質問には 2-3 営業日以内に回答いたします。

## デモ

https://github.com/geekan/MetaGPT/assets/2707039/5e8c1062-8c35-440f-bb20-2b0320f8d27d

## 参加する

📢 Discord チャンネルに参加してください！
https://discord.gg/ZRHeExS6xv

お会いできることを楽しみにしています！ 🎉



## Roadmap

### Long-term Objective

Enable MetaGPT to self-evolve, accomplishing self-training, fine-tuning, optimization, utilization, and updates.

### Short-term Objective

1. Become the multi-agent framework with the highest ROI.
2. Support fully automatic implementation of medium-sized projects (around 2000 lines of code).
3. Implement most identified tasks, reaching version 0.5.

### Tasks

To reach version v0.5, approximately 70% of the following tasks need to be completed.

1. Usability
   1. Release v0.01 pip package to try to solve issues like npm installation (though not necessarily successfully)
   2. Support for overall save and recovery of software companies
   3. Support human confirmation and modification during the process
   4. Support process caching: Consider carefully whether to add server caching mechanism
   5. Resolve occasional failure to follow instruction under current prompts, causing code parsing errors, through stricter system prompts
   6. Write documentation, describing the current features and usage at all levels
   7. ~~Support Docker~~
2. Features
   1. Support a more standard and stable parser (need to analyze the format that the current LLM is better at)
   2. ~~Establish a separate output queue, differentiated from the message queue~~
   3. Attempt to atomize all role work, but this may significantly increase token overhead
   4. Complete the design and implementation of module breakdown
   5. Support various modes of memory: clearly distinguish between long-term and short-term memory
   6. Perfect the test role, and carry out necessary interactions with humans
   7. Provide full mode instead of the current fast mode, allowing natural communication between roles
   8. Implement SkillManager and the process of incremental Skill learning
   9. Automatically get RPM and configure it by calling the corresponding openai page, so that each key does not need to be manually configured
3. Strategies
   1. Support ReAct strategy
   2. Support CoT strategy
   3. Support ToT strategy
   4. Support Reflection strategy
4. Actions
   1. Implementation: Search
   2. Implementation: Knowledge search, supporting 10+ data formats
   3. Implementation: Data EDA
   4. Implementation: Review
   5. Implementation: Add Document
   6. Implementation: Delete Document
   7. Implementation: Self-training
   8. Implementation: DebugError
   9. Implementation: Generate reliable unit tests based on YAPI
   10. Implementation: Self-evaluation
   11. Implementation: AI Invocation
   12. Implementation: Learning and using third-party standard libraries
   13. Implementation: Data collection
   14. Implementation: AI training
   15. Implementation: Run code
   16. Implementation: Web access
5. Plugins: Compatibility with plugin system
6. Tools
   1. ~~Support SERPER api~~
   2. ~~Support Selenium apis~~
   3. ~~Support Playwright apis~~
7. Roles
   1. Perfect the action pool/skill pool for each role
   2. Red Book blogger
   3. E-commerce seller
   4. Data analyst
   5. News observer
   6. Institutional researcher
8. Evaluation
   1. Support an evaluation on a game dataset
   2. Reproduce papers, implement full skill acquisition for a single game role, achieving SOTA results
   3. Support an evaluation on a math dataset
   4. Reproduce papers, achieving SOTA results for current mathematical problem solving process
9. LLM
   1. Support Claude underlying API
   2. ~~Support Azure asynchronous API~~
   3. Support streaming version of all APIs
   4. ~~Make gpt-3.5-turbo available (HARD)~~
10. Other
    1. Clean up existing unused code
    2. Unify all code styles and establish contribution standards
    3. Multi-language support
    4. Multi-programming-language support


# `examples/agent_creator.py`

这段代码是一个Python脚本，它的作用是定义了一个名为"AgentCreator"的角色，该角色具有在一个指定工作空间中创建自定义代理的能力。通过导入一些必要的模块和函数，该脚本使用已定义的"Action"和"Role"类，从"metagpt.schema"中读取了一个名为"MULTI_ACTION_AGENT_CODE_EXAMPLE"的模板文件，并将其内容存储在变量中。接下来，该脚本使用"with"语句打开了一个名为"examples/build_customized_agent.py"的文件，读取其中的内容并将其存储在另一个名为"MULTI_ACTION_AGENT_CODE_EXAMPLE"的变量中。


```py
'''
Filename: MetaGPT/examples/agent_creator.py
Created Date: Tuesday, September 12th 2023, 3:28:37 pm
Author: garylin2099
'''
import re

from metagpt.const import PROJECT_ROOT, WORKSPACE_ROOT
from metagpt.actions import Action
from metagpt.roles import Role
from metagpt.schema import Message
from metagpt.logs import logger

with open(PROJECT_ROOT / "examples/build_customized_agent.py", "r") as f:
    # use official example script to guide AgentCreator
    MULTI_ACTION_AGENT_CODE_EXAMPLE = f.read()

```

这段代码定义了一个名为 `CreateAgent` 的类，它实现了 `Action` 接口。这个类包括一个名为 `run` 的方法，该方法接受两个参数 `example` 和 `instruction`，这两个参数用于描述要执行的动作。

`run` 方法首先使用 `PROMPT_TEMPLATE` 来生成一个用于调用 `_aask` 方法的模板，其中 `example` 和 `instruction` 参数用于替换模板中的变量。然后，它使用 `format` 方法将模板中的参数替换为实际的参数，并将结果保存到一个 `rsp` 变量中。

接着，它使用 `re.DOTALL` 模式从 `rsp` 中提取出匹配 `pattern` 模式的行，并将匹配到的内容（如果找到了）存储到 `code_text` 变量中。最后，它使用 `f.write` 方法将 `code_text` 写入一个名为 `agent_created_agent.py` 的文件中，并返回该文件的内容。

由于 `run` 方法中使用了 `asyncio` 库，因此它还实现了 `run` 方法，这个方法会在合适的时机会异步地执行，并在异步执行成功后返回结果。


```py
class CreateAgent(Action):

    PROMPT_TEMPLATE = """
    ### BACKGROUND
    You are using an agent framework called metagpt to write agents capable of different actions,
    the usage of metagpt can be illustrated by the following example:
    ### EXAMPLE STARTS AT THIS LINE
    {example}
    ### EXAMPLE ENDS AT THIS LINE
    ### TASK
    Now you should create an agent with appropriate actions based on the instruction, consider carefully about
    the PROMPT_TEMPLATE of all actions and when to call self._aask()
    ### INSTRUCTION
    {instruction}
    ### YOUR CODE
    Return ```python your_code_here ```py with NO other texts, your code:
    """

    async def run(self, example: str, instruction: str):

        prompt = self.PROMPT_TEMPLATE.format(example=example, instruction=instruction)
        # logger.info(prompt)

        rsp = await self._aask(prompt)

        code_text = CreateAgent.parse_code(rsp)

        return code_text

    @staticmethod
    def parse_code(rsp):
        pattern = r'```python(.*)```py'
        match = re.search(pattern, rsp, re.DOTALL)
        code_text = match.group(1) if match else ""
        with open(WORKSPACE_ROOT / "agent_created_agent.py", "w") as f:
            f.write(code_text)
        return code_text

```

这段代码定义了一个名为 AgentCreator 的类，继承自 Role 类。这个类接受一个 name 参数、一个 profile 参数和一个 agent_template 参数，这些参数都包含关键字 arguments。

在 __init__ 方法中，首先调用父类的构造函数，然后设置自己的初始值。接着，调用自己的方法 _init_actions，这个方法会在创建实例时自动执行，确保所有方法都已经被初始化。最后，将 agent_template 参数传递给父类的构造函数。

接着，定义了一个名为 _act 的方法，这个方法是一个异步方法，会等待被调用时执行。在 _act 方法中，获取被设置的角色的 todo 属性，然后获取该角色的 memory 中存储的最后一个内容，也就是消息内容。

接着，使用这个角色的 memory 中的内容，调用 CreateAgent 类的一个实例，传入 example 和 instruction 参数，执行 agent_template 指定的指令，并获取执行结果。然后，创建一个 Message 实例，包含该角色的 profile、todo 和 instruction，以及生成的消息内容。最后，将生成的 Message 发送回角色。


```py
class AgentCreator(Role):
    def __init__(
        self,
        name: str = "Matrix",
        profile: str = "AgentCreator",
        agent_template: str = MULTI_ACTION_AGENT_CODE_EXAMPLE,
        **kwargs,
    ):
        super().__init__(name, profile, **kwargs)
        self._init_actions([CreateAgent])
        self.agent_template = agent_template

    async def _act(self) -> Message:
        logger.info(f"{self._setting}: ready to {self._rc.todo}")
        todo = self._rc.todo
        msg = self._rc.memory.get()[-1]

        instruction = msg.content
        code_text = await CreateAgent().run(example=self.agent_template, instruction=instruction)
        msg = Message(content=code_text, role=self.profile, cause_by=todo)

        return msg

```

这段代码使用了Python的asyncio库来实现异步编程。在这个示例中，我们定义了一个名为`main`的函数，它使用了Python 3.7中引入的多任务代理策略（MULTI_ACTION_AGENT_CODE_EXAMPLE）。

具体来说，这段代码的作用是创建一个名为`SimpleTester`的代理程序，它接收一个给定的代码片段（字符串），然后执行相应的测试代码并将其保存为文件。然后，它可以运行这个测试代码。

代码中定义了一个名为`agent_template`的类，它可能是一个经过优化的代码片段。在这个例子中，我们并没有定义具体的`agent_template`类，而是直接使用了Python标准库中的`MULTI_ACTION_AGENT_CODE_EXAMPLE`类型。

最后，我们定义了一个`main`函数，它使用`AgentCreator`类创建了一个`SimpleTester`代理程序。然后，它使用`run`方法将消息（字符串）传递给代理程序，并等待其执行。


```py
if __name__ == "__main__":
    import asyncio

    async def main():

        agent_template = MULTI_ACTION_AGENT_CODE_EXAMPLE

        creator = AgentCreator(agent_template=agent_template)

        # msg = """Write an agent called SimpleTester that will take any code snippet (str)
        #     and return a testing code (str) for testing
        #     the given code snippet. Use pytest as the testing framework."""

        msg = """
        Write an agent called SimpleTester that will take any code snippet (str) and do the following:
        1. write a testing code (str) for testing the given code snippet, save the testing code as a .py file in the current working directory;
        2. run the testing code.
        You can use pytest as the testing framework.
        """
        await creator.run(msg)

    asyncio.run(main())

```